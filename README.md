# Meeting Agenda Agent v0.2

Local agenda planning on top of the Spine SQLite store. The agent retrieves recent org facts, proposes meeting agendas, and persists proposals as `facts` rows so reviewers can update the status lifecycle (`draft → proposed → validated → published → rejected`).

## Highlights
- SQLite Spine schema (facts, evidence, entities, transcripts) with optional FTS5.
- Retrieval helpers to pull recent or subject-focused facts with hydrated evidence/entities.
- Planner writes idempotent agenda proposals (`fact_type='meeting_metadata'`, `payload.kind='agenda_proposal'`).
- CLI + HTTP API for proposing agendas, listing proposals, searching facts, and updating statuses.
- Seed/demo scripts to populate a local DB for quick testing.

## Requirements
- Python 3.11+
- No external services needed; SQLite is bundled.
- Optional: FastAPI + Uvicorn for the HTTP API (install via `pip install fastapi uvicorn`).

## Running locally
```bash
python -m agent.cli init-db --org org_demo
python -m agent.cli seed minimal
python -m agent.cli agenda propose --org org_demo --subject "Quarterly sync"
python -m agent.cli agenda list --org org_demo
```

Want an end-to-end demo? Run `python -m scripts.demo_flow` to seed data, propose an agenda, and show the latest proposals.

## CLI reference
- `init-db` – create the SQLite schema and ensure an org exists.
- `org add <org_id> [name]` – insert/update an org.
- `agenda propose [...]` – generate + persist an agenda.
- `agenda list [--limit N]` – show recent agenda proposals.
- `facts search [--q text] [--types a,b]` – FTS-backed search across facts/evidence.
- `facts set-status <fact_id> <status>` – update reviewer status.
- `seed minimal` – load demo data via the helper script.

Example:
```bash
python -m agent.cli facts search --org org_demo --q "pricing" --types decision,action_item
```

## Loading parsing output
To load a full Spine bundle generated by the parsing agent:
```bash
python -m scripts.ingest_bundle ../parsing-agent/out/spine_bundle.json --status draft --org-name "My Org"
```
This copies the bundle facts, evidence, participants, and transcript metadata into the local SQLite Spine DB.

Alternatively, you can use the convenience script that will also create/upgrade the DB schema if needed and populate new evidence fields like `utterance_ids`, `char_span`, `card_id`, and `who_said_id`:
```bash
python -m scripts.store_items ../parsing-agent/out/spine_bundle.json --status draft --org-name "My Org"
```
The database path defaults to `./spine_dev.sqlite3` (override with env `SPINE_DB_PATH`).

## Inspecting the DB
Quickly inspect tables, orgs, fact counts, and sample rows:

```powershell
# Show overall stats
python -m scripts.inspect_db

# Filter by org and limit samples
python -m scripts.inspect_db --org byd --limit 10
```
Notes:
- The script resolves the DB path in this order: env `SPINE_DB_PATH` → `agent.config.spine_db_path()` → `meeting-agent/spine_dev.sqlite3`.
- If you see "DB file not found", check your current working directory and `SPINE_DB_PATH`.
## HTTP API (optional)
Run `python -m agent.api` once FastAPI/Uvicorn are installed. Key endpoints:
- `POST /agenda/propose` – body `{ "org": "org_demo", "subject": "Q4 kickoff" }`
- `GET /agenda/proposals?org=org_demo&limit=10`
- `GET /facts/search?org=org_demo&q=pricing&types=decision,action_item`
- `POST /facts/{fact_id}/status` – body `{ "status": "validated" }`

## Data notes
- Database path defaults to `./spine_dev.sqlite3` (override with `SPINE_DB_PATH`).
- FTS can be disabled via `SPINE_FTS_ENABLED=0`.
- Default org id is `org_demo` (override with `DEFAULT_ORG_ID`).
- Agenda proposals are idempotent using a hash of org, meeting, subject, and agenda JSON.

## Development checklist
- `python -m agent.cli init-db`
- `python -m agent.cli seed minimal`
- `python -m agent.cli facts search --org org_demo --q "pricing"`
- `python -m agent.cli agenda propose --org org_demo --subject "Q4 kickoff"`
- `python -m agent.cli facts set-status <fact_id> validated`

Happy planning!


